{% extends "base.html" %}

{% block title %}System Odyseusz - Logowanie{% endblock %}

{% block head %}
<style>
    /* --- STYLE PODSTAWOWE MODALA --- */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(3px);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    .modal-overlay.active { display: flex; }

    /* --- STYLE TWOJEGO MOCKA WƒòZ≈ÅA KRAJOWEGO (WewnƒÖtrz modala) --- */
    .wezel-mock-container {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: white;
        padding: 40px;
        width: 100%;
        max-width: 450px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        border-top: 5px solid #dc3545; /* Polski czerwony */
        text-align: center;
        border-radius: 4px;
        position: relative;
    }
    
    .wezel-header-logo { font-size: 3rem; margin-bottom: 10px; }
    .wezel-title { font-size: 1.2rem; color: #333; margin-bottom: 30px; font-weight: bold; }
    
    /* Przyciski w stylu wƒôz≈Ça */
    .mock-btn {
        display: block;
        width: 100%;
        padding: 15px;
        margin-bottom: 15px;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: 0.2s;
        text-align: left;
        position: relative;
        border-radius: 4px;
    }

    .btn-existing { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
    .btn-existing:hover { background-color: #c8e6c9; }

    .btn-new { background-color: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }
    .btn-new:hover { background-color: #bbdefb; }

    .wezel-note {
        font-size: 0.8rem;
        color: #666;
        margin-top: 20px;
        border-top: 1px solid #eee;
        padding-top: 10px;
    }
    .arrow { float: right; }

    /* Zamkniƒôcie modala */
    .close-modal {
        position: absolute;
        top: 10px; right: 15px;
        font-size: 24px; color: #aaa;
        cursor: pointer;
    }
    .close-modal:hover { color: #000; }


    /* --- PE≈ÅNOEKRANOWY EKRAN MOBYWATEL (SCREENSHOT) --- */
    .mobywatel-fullscreen {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: #fff;
        z-index: 2000; /* Nad modalem */
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .mobywatel-fullscreen.active { display: flex; }

    .qr-screen-img {
        max-width: 100%;
        max-height: 80vh;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .processing-info {
        margin-top: 20px;
        font-size: 1.2rem;
        color: #333;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<div class="login-mockup">
    <h2>Zaloguj siƒô do systemu</h2>
    
    <div class="login-option" id="mobywatelBtn">
        <span class="login-option-icon">üîí</span>
        <div class="login-option-text">
            <strong>Profil zaufany</strong>
            <small>U≈ºyj loginu i has≈Ça lub bankowo≈õci elektronicznej.</small>
        </div>
        <span class="login-option-arrow">></span>
    </div>

    <div class="login-option" id="actualLoginBtn">
        <span class="login-option-icon">üì±</span>
        <div class="login-option-text">
            <strong>Aplikacja Odyseusz</strong>
            <span class="recommended-badge">Polecany</span>
            <small>Zaloguj siƒô do systemu Odyseusz.</small>
        </div>
        <span class="login-option-arrow">></span>
    </div>

    <div class="login-option inactive" onclick="alert('Ta funkcja jest w przygotowaniu.');">
        <span class="login-option-icon">üèõÔ∏è</span>
        <div class="login-option-text">
            <strong>Bankowo≈õƒá elektroniczna</strong>
            <small>Zaloguj siƒô za pomocƒÖ swojego banku.</small>
        </div>
        <span class="login-option-arrow">></span>
    </div>
    
    <div class="login-option inactive" onclick="alert('Ta funkcja jest w przygotowaniu.');">
        <span class="login-option-icon">üåê</span> 
        <div class="login-option-text">
            <strong>E-dow√≥d</strong>
            <small>U≈ºyj dowodu osobistego z warstwƒÖ elektronicznƒÖ i smartfona lub czytnika NFC.</small>
        </div>
        <span class="login-option-arrow">></span>
    </div>
</div>

<div id="wezelModal" class="modal-overlay">
    <div class="wezel-mock-container">
        <span class="close-modal" id="closeWezel">&times;</span>
        
        <div class="wezel-header-logo">ü¶Ö</div>
        <div class="wezel-title">Wƒôze≈Ç Krajowy / Login.gov.pl</div>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">Symulacja potwierdzenia to≈ºsamo≈õci</p>

        <button class="mock-btn btn-existing" onclick="startFlow('existing')">
            üë§ Zaloguj jako: Jan Kowalski
            <div style="font-size: 0.75em; font-weight: normal;">U≈ºytkownik ju≈º posiada konto w Odyseuszu.</div>
            <span class="arrow">‚Üí</span>
        </button>

        <button class="mock-btn btn-new" onclick="startFlow('new')">
            üÜï Zaloguj jako: Anna Nowak
            <div style="font-size: 0.75em; font-weight: normal;">Pierwsze logowanie (wymaga uzupe≈Çnienia danych).</div>
            <span class="arrow">‚Üí</span>
        </button>

        <div class="wezel-note">
            To jest ekran symulacyjny (Mock) ≈õrodowiska testowego.
        </div>
    </div>
</div>

<div id="mobywatelScreen" class="mobywatel-fullscreen">
    <img src="{{ url_for('static', filename='img/mobywatel_qr.png') }}" alt="mObywatel App" class="qr-screen-img">
    <div class="processing-info">Przetwarzanie danych to≈ºsamo≈õci...</div>
</div>

<form id="finalAuthForm" action="{{ url_for('auth.mobywatel_callback') }}" method="POST" style="display: none;">
    <input type="hidden" name="scenario" id="scenarioInput">
</form>

{% endblock %}

{% block scripts %}
<script>

    // Elementy DOM
    const openWezelBtn = document.getElementById('mobywatelBtn');
    const wezelModal = document.getElementById('wezelModal');
    const closeWezel = document.getElementById('closeWezel');
    
    const mobywatelScreen = document.getElementById('mobywatelScreen');
    const finalAuthForm = document.getElementById('finalAuthForm');
    const scenarioInput = document.getElementById('scenarioInput');

    // 1. Otwieranie Modala z Wƒôz≈Çem
    openWezelBtn.onclick = () => {
        wezelModal.classList.add('active');
    };

    // Zamykanie Modala
    closeWezel.onclick = () => {
        wezelModal.classList.remove('active');
    };

    // 2. Logika przej≈õcia (Flow)
    window.startFlow = (scenario) => {
        // Krok A: Zamknij modal wyboru
        wezelModal.classList.remove('active');

        // Krok B: Poka≈º pe≈Çnoekranowy screenshot
        mobywatelScreen.classList.add('active');

        // Krok C: Ustaw wybrany scenariusz w ukrytym formularzu
        scenarioInput.value = scenario;

        // Krok D: Czekaj 5 sekund i wy≈õlij formularz
        setTimeout(() => {
            finalAuthForm.submit();
        }, 5000); // 5000 ms = 5 sekund
    };

    // PRZEKIEROWANIE DLA LOGOWANIA
    document.getElementById('actualLoginBtn').onclick = () => {
        location.href = "{{ url_for('auth.login_page') }}";
    };



</script>
{% endblock %}
