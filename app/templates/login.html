{% extends "base.html" %}

{% block title %}Logowanie – Odyseusz 2.0{% endblock %}

{% block head %}
<style>
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    
    .auth-card {
        background: var(--white);
        padding: 40px;
        border-radius: var(--radius);
        box-shadow: var(--shadow); 
        max-width: 450px;
        margin: 40px auto;
        text-align: center;
    }

    .auth-card h2 {
        color: var(--primary-dark);
        margin-bottom: 10px;
        font-size: 1.75rem;
    }

    .auth-card p {
        color: var(--text-secondary);
        margin-bottom: 30px;
    }

    .auth-card .form-group {
        margin-bottom: 20px;
        text-align: left; 
    }

    .auth-card .btn {
        width: 100%;
        justify-content: center;
        font-size: 1rem;
        padding: 12px;
    }

    .separator {
        margin: 30px 0;
        border-top: 1px solid var(--gray-200);
        position: relative;
    }

    .separator span {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #fff;
        padding: 0 10px;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }


    .registration-actions {
        display: flex;
        flex-direction: column;
        gap: 15px; 
    }

    .btn-secondary {
        background: transparent;
        border: 2px solid var(--gray-200);
        color: var(--gray-700);
        box-shadow: none;
    }

    .btn-secondary:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--gray-50);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-card">
    <h2>Witaj w Odyseuszu</h2>
    <p>Zaloguj się, aby zarządzać podróżami.</p>
    
    <form id="loginForm" class="login-form">
        <div class="form-group">
            <input type="text" name="login" placeholder="Login" class="form-control" required>
        </div>
        <div class="form-group">
            <input type="password" name="password" placeholder="Hasło" class="form-control" required>
        </div>
        <button type="submit" class="btn">Zaloguj się</button>
    </form>
    
    <div id="message" style="margin-top: 15px; font-weight: 500; color: var(--danger);"></div>

    <div class="separator">
        <span>lub</span>
    </div>
    
    <div class="registration-actions">
        <button class="btn btn-secondary" id="registerTravelerBtn">Zarejestruj</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const form = document.getElementById('loginForm');
const msgDiv = document.getElementById('message');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msgDiv.textContent = ""; // Czyść komunikaty
    const data = Object.fromEntries(new FormData(form));

    try {
        const res = await fetch('/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.ok) {
            if (result.redirect_url) {
                window.location.href = result.redirect_url;
            } else {
                msgDiv.style.color = "var(--accent)";
                msgDiv.textContent = result.message;
            }
        } else {
            msgDiv.style.color = "var(--danger)";
            msgDiv.textContent = result.error || "Błąd logowania";
        }
    } catch (err) {
        msgDiv.style.color = "var(--danger)";
        msgDiv.textContent = `Błąd sieci: ${err.message}`;
    }
});

document.getElementById('registerTravelerBtn').onclick = () => {
    window.location.href = "{{ url_for('app_bp.register_traveler_page') }}";
};

</script>
{% endblock %}