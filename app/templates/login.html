{% extends "base.html" %}

{% block title %}Logowanie – Odyseusz 2.0{% endblock %}

{% block content %}
<div class="login-container">
    <h2>Logowanie do systemu Odyseusz</h2>
    <p>Proszę podać dane dostępowe.</p>
    
    <form id="loginForm" class="login-form">
        <div class="form-group">
            <input type="text" name="login" placeholder="Login" class="form-control" required>
        </div>
        <div class="form-group">
            <input type="password" name="password" placeholder="Hasło" class="form-control" required>
        </div>
        <button type="submit" class="btn">Zaloguj</button>
    </form>
    <div id="message"></div>

    <hr>
    
    <div class="btn-group-vertical">
        <button class="btn btn-secondary" id="registerTravelerBtn">Zarejestruj podróżnego</button>
        <button class="btn btn-secondary" id="registerEmployeeBtn">Zarejestruj pracownika (admin)</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const form = document.getElementById('loginForm');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form));

    try {
        const res = await fetch('/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.ok) {
            // Jeśli logowanie udane, przekierowanie zależne od roli
            if (result.redirect_url) {
                window.location.href = result.redirect_url;
            } else {
                document.getElementById('message').textContent = result.message;
            }
        } else {
            // Błąd logowania
            document.getElementById('message').textContent = result.error || "Błąd logowania";
        }
    } catch (err) {
        document.getElementById('message').textContent = `Błąd sieci: ${err.message}`;
    }
});

// Przyciski do rejestracji
document.getElementById('registerTravelerBtn').onclick = () => {
    window.location.href = "{{ url_for('app_bp.register_traveler_page') }}";
};
document.getElementById('registerEmployeeBtn').onclick = () => {
    window.location.href = "{{ url_for('app_bp.register_employee_page') }}";
};
</script>
{% endblock %}